<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>CodeSync | Results</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-900 text-white min-h-screen flex flex-col items-center p-4">
  <h1 class="text-3xl font-bold my-6">üìä Coding Profile Stats</h1>

  <div id="resultContainer" class="w-full max-w-4xl space-y-6">
    <!-- Platform cards will be inserted here -->
  </div>

  <script>
    const queryParams = new URLSearchParams(window.location.search);
    const username = queryParams.get("username");

    if (!username) {
      document.getElementById("resultContainer").innerHTML = `
        <div class="text-red-500 text-center font-semibold">‚ùå Username not found. Please return to the homepage.</div>
      `;
    } else {
      fetchScores(username);
    }

    async function fetchScores(username) {
      try {
        // Call both APIs
        const [mainRes, gfgRes] = await Promise.all([
          fetch(`https://8teu07es5h.execute-api.us-east-1.amazonaws.com/prob/get-score?username=${username}`),
          fetch(`https://1irslt4qe5.execute-api.us-east-1.amazonaws.com/prob/get-score?username=${username}`)
        ]);

        const [mainData, gfgData] = await Promise.all([
          mainRes.json(),
          gfgRes.json()
        ]);

        renderCard("LeetCode", "https://assets.leetcode.com/static_assets/public/icons/favicon-96x96.png", mainData.leetcode);
        renderCard("CodeChef", "https://cdn.codechef.com/sites/all/themes/abessive/cc-logo.png", mainData.codechef);
        renderCard("HackerRank", "https://hrcdn.net/community-frontend/assets/favicon-32x32.png", mainData.hackerrank);
        renderCard("GeeksforGeeks", "https://media.geeksforgeeks.org/wp-content/cdn-uploads/gfg_200X200.png", gfgData);
      } catch (error) {
        document.getElementById("resultContainer").innerHTML = `
          <div class="text-red-500 text-center font-semibold">‚ùå Failed to fetch scores. Please try again later.</div>
        `;
        console.error("Error fetching scores:", error);
      }
    }

    function renderCard(platform, logoUrl, data) {
      if (!data) return;

      let card = `
        <div class="bg-gray-800 p-6 rounded-2xl shadow-lg">
          <div class="flex items-center space-x-4 mb-4">
            <img src="${logoUrl}" alt="${platform} Logo" class="w-10 h-10 rounded-full" />
            <h2 class="text-xl font-semibold">${platform}</h2>
          </div>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
      `;

      for (const key in data) {
        const value = data[key] || "N/A";
        const label = key.replace(/_/g, " ").replace(/\b\w/g, l => l.toUpperCase());
        card += `
          <div class="bg-gray-700 p-3 rounded-lg">
            <span class="font-semibold">${label}:</span> ${value}
          </div>
        `;
      }

      card += `</div></div>`;
      document.getElementById("resultContainer").innerHTML += card;
    }
  </script>
</body>
</html>
