<!DOCTYPE html>
<html lang="en">
<head>
    <!-- ... keep existing head content ... -->
    <!-- Add these scripts -->
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1121.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/amazon-cognito-identity-js@5.2.10/dist/amazon-cognito-identity.min.js"></script>
    <style>
        /* Add auth styles */
        .auth-container {
            position: absolute;
            top: 1rem;
            right: 1rem;
            display: flex;
            gap: 0.5rem;
            z-index: 1000;
        }
        .auth-button {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .auth-button:hover {
            background: rgba(255, 255, 255, 0.2);
        }
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- Add this auth container at the top of your body -->
    <div class="auth-container">
        <button id="loginButton" class="auth-button">Sign In</button>
        <div id="userInfo" class="hidden">
            <span id="username" class="text-white mr-2"></span>
            <button id="logoutButton" class="auth-button">Sign Out</button>
        </div>
    </div>

    <!-- Your existing content remains here -->

    <script>
        // AWS Cognito Configuration - UPDATE THESE VALUES
        const awsConfig = {
            region: 'us-east-1', // Your AWS region
            userPoolId: 'us-east-1_RMhlKuGHS', // Your User Pool ID
            userPoolWebClientId: '4g0bo9ac68vq4g817v1je4e5sf', // Your App Client ID
            domain: 'codingsync.auth.us-east-1.amazoncognito.com' // Your Cognito Domain
        };

        // Initialize AWS
        AWS.config.update({ region: awsConfig.region });

        // Initialize Cognito
        const userPool = new AmazonCognitoIdentity.CognitoUserPool({
            UserPoolId: awsConfig.userPoolId,
            ClientId: awsConfig.userPoolWebClientId
        });

        // Check if user is authenticated
        function checkAuth() {
            const cognitoUser = userPool.getCurrentUser();
            
            if (cognitoUser) {
                cognitoUser.getSession((err, session) => {
                    if (err || !session.isValid()) {
                        showLogin();
                    } else {
                        showUserInfo(cognitoUser);
                    }
                });
            } else {
                showLogin();
            }
        }

        // Show login button
        function showLogin() {
            document.getElementById('loginButton').classList.remove('hidden');
            document.getElementById('userInfo').classList.add('hidden');
        }

        // Show user info
        function showUserInfo(cognitoUser) {
            document.getElementById('loginButton').classList.add('hidden');
            document.getElementById('userInfo').classList.remove('hidden');
            
            cognitoUser.getUserAttributes((err, attributes) => {
                if (err) {
                    console.error('Error getting user attributes:', err);
                    return;
                }
                
                const emailAttr = attributes.find(attr => attr.Name === 'email');
                if (emailAttr) {
                    document.getElementById('username').textContent = emailAttr.Value;
                }
            });
        }

        // Handle login
        document.getElementById('loginButton').addEventListener('click', () => {
            const redirectUri = encodeURIComponent('https://gowthusaidatta.github.io/codeSync/index.html');
            const loginUrl = `https://${awsConfig.domain}/login?response_type=code&client_id=${awsConfig.userPoolWebClientId}&redirect_uri=${redirectUri}`;
            window.location.href = loginUrl;
        });

        // Handle logout
        document.getElementById('logoutButton').addEventListener('click', () => {
            const cognitoUser = userPool.getCurrentUser();
            if (cognitoUser) {
                cognitoUser.signOut();
                showLogin();
            }
        });

        // Handle authentication callback
        function handleAuthCallback() {
            const urlParams = new URLSearchParams(window.location.search);
            const code = urlParams.get('code');
            
            if (code) {
                // Remove code from URL
                window.history.replaceState({}, document.title, window.location.pathname);
                
                // Exchange authorization code for tokens
                const tokenUrl = `https://${awsConfig.domain}/oauth2/token`;
                const redirectUri = 'https://gowthusaidatta.github.io/codeSync/index.html';
                
                const body = new URLSearchParams();
                body.append('grant_type', 'authorization_code');
                body.append('client_id', awsConfig.userPoolWebClientId);
                body.append('code', code);
                body.append('redirect_uri', redirectUri);
                
                fetch(tokenUrl, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded'
                    },
                    body: body
                })
                .then(response => response.json())
                .then(data => {
                    if (data.id_token) {
                        // Create Cognito user session
                        const userData = {
                            Username: data.id_token.payload['cognito:username'],
                            Pool: userPool
                        };
                        
                        const cognitoUser = new AmazonCognitoIdentity.CognitoUser(userData);
                        
                        const sessionData = {
                            IdToken: new AmazonCognitoIdentity.CognitoIdToken({ IdToken: data.id_token }),
                            AccessToken: new AmazonCognitoIdentity.CognitoAccessToken({ AccessToken: data.access_token }),
                            RefreshToken: new AmazonCognitoIdentity.CognitoRefreshToken({ RefreshToken: data.refresh_token })
                        };
                        
                        const session = new AmazonCognitoIdentity.CognitoUserSession(sessionData);
                        cognitoUser.setSignInUserSession(session);
                        
                        checkAuth();
                    }
                })
                .catch(error => {
                    console.error('Error during token exchange:', error);
                });
            }
        }

        // Initialize authentication
        document.addEventListener('DOMContentLoaded', () => {
            checkAuth();
            handleAuthCallback();
            
            // Your existing DOMContentLoaded code...
        });
    </script>
</body>
</html>
